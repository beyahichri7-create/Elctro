<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Sport Market Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
    body { margin:0; font-family: 'Arial', sans-serif; background:#0b0f1a; color:#fff; text-align: center; }
    #login { height:100vh; display:flex; flex-direction:column; justify-content:center; align-items:center; padding:20px; }
    input, button { margin:8px 0; padding:12px; border-radius:8px; border:none; width:80%; max-width:300px; outline: none; }
    input { color: #000; }
    button { background:#1e90ff; color:#fff; font-size:16px; cursor:pointer; font-weight: bold; }
    button:hover { background: #1565c0; }
    #app { padding-bottom:70px; }
    header { padding:15px; font-size:22px; font-weight:bold; background:#11162a; border-bottom: 2px solid #1e90ff; }
    .product { background:#161c36; margin:15px; padding:15px; border-radius:12px; border: 1px solid #2a345e; }
    .product img { width:100%; border-radius:8px; max-height: 250px; object-fit: cover; }
    .nav { position:fixed; bottom:0; width:100%; background:#11162a; display:flex; border-top: 1px solid #1e90ff; }
    .nav div { flex:1; text-align:center; padding:15px; font-size:20px; cursor:pointer; }
    .hidden { display:none; }
    .star { color:#ffcc00; }
</style>
</head>
<body>

<div id="login">
    <h1 style="color: #1e90ff;">Sport Market</h1>
    <h3>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ / Ø§Ø´ØªØ±Ø§Ùƒ</h3>
    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„">
    <input id="lastname" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
    <p id="msg" style="font-size: 12px; color: #888;">* Ø¥Ø°Ø§ ÙƒÙ†Øª Ø¬Ø¯ÙŠØ¯Ø§Ù‹ØŒ Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¨Ù†ÙØ³ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±.</p>
</div>

<div id="app" class="hidden">
    <header onclick="goHome()">ğŸ® Sport Market Games</header>
    <div id="home"></div>
    <div id="add" class="hidden">
        <h3>Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
        <input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="pprice" placeholder="Ø§Ù„Ø³Ø¹Ø± (DT)">
        <input id="plocation" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†">
        <input id="pdesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="pimg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
        <button onclick="addProduct()">Ù†Ø´Ø± Ø§Ù„Ù…Ù†ØªØ¬</button>
    </div>
    <div id="search" class="hidden">
        <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³ØªØ®Ø¯Ù…..." oninput="searchUser()">
        <div id="searchResults"></div>
    </div>
    <div id="profile" class="hidden"></div>
</div>

<div class="nav hidden" id="nav">
    <div onclick="show('home')">ğŸ </div>
    <div onclick="show('add')">â•</div>
    <div onclick="show('search')">ğŸ”</div>
    <div onclick="show('profile')">ğŸ‘¤</div>
</div>

<script>
let currentUser = null;

function login(){
    const nameV = document.getElementById("name").value.trim();
    const lastnameV = document.getElementById("lastname").value.trim();
    const passwordV = document.getElementById("password").value;

    if(!nameV || !lastnameV || !passwordV){
        alert("ÙŠØ±Ø¬Ù‰ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
        return;
    }

    let users = JSON.parse(localStorage.getItem("users") || "[]");
    let userIndex = users.findIndex(u => u.name.toLowerCase() === nameV.toLowerCase() && u.lastname.toLowerCase() === lastnameV.toLowerCase());

    if(userIndex === -1){
        // Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯ - Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨
        let newUser = {
            name: nameV,
            lastname: lastnameV,
            password: passwordV,
            followers: 0,
            products: []
        };
        users.push(newUser);
        localStorage.setItem("users", JSON.stringify(users));
        currentUser = newUser;
        alert("ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø³Ø§Ø¨Ùƒ Ø§Ù„Ø¬Ø¯ÙŠØ¯ Ø¨Ù†Ø¬Ø§Ø­! ØªØ°ÙƒØ± ÙƒÙ„Ù…Ø© Ø³Ø±Ùƒ Ø¯Ø§Ø¦Ù…Ø§Ù‹.");
    } else {
        // Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±
        if(users[userIndex].password === passwordV){
            currentUser = users[userIndex];
        } else {
            alert("âš ï¸ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø­Ø³Ø§Ø¨!");
            return;
        }
    }

    localStorage.setItem("session", JSON.stringify(currentUser));
    startApp();
}

function startApp(){
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
    document.getElementById("nav").classList.remove("hidden");
    loadHome();
    loadProfile();
}

function show(id){
    ["home","add","search","profile"].forEach(x => document.getElementById(x).classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}

function addProduct(){
    const pname = document.getElementById("pname").value;
    const pprice = document.getElementById("pprice").value;
    const pimg = document.getElementById("pimg").value;
    if(!pname || !pprice || !pimg) { alert("Ø£ÙƒÙ…Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©"); return; }

    let products = JSON.parse(localStorage.getItem("products") || "[]");
    const newProduct = {
        name: pname,
        price: pprice,
        img: pimg,
        owner: currentUser.name + " " + currentUser.lastname,
        desc: document.getElementById("pdesc").value
    };
    products.push(newProduct);
    localStorage.setItem("products", JSON.stringify(products));
    
    // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    let users = JSON.parse(localStorage.getItem("users"));
    let idx = users.findIndex(u => u.name === currentUser.name);
    users[idx].products.push(newProduct);
    localStorage.setItem("users", JSON.stringify(users));
    currentUser = users[idx];

    alert("ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­");
    show('home');
    loadHome();
}

function loadHome(){
    const home = document.getElementById("home");
    let products = JSON.parse(localStorage.getItem("products") || "[]");
    home.innerHTML = products.length ? "" : "<p>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ù…Ø¹Ø±ÙˆØ¶Ø©</p>";
    products.forEach(p => {
        home.innerHTML += `
            <div class="product">
                <img src="${p.img}" onerror="this.src='https://via.placeholder.com/300x200?text=No+Image'">
                <h3>${p.name}</h3>
                <p>${p.desc}</p>
                <b style="color:#1e90ff">${p.price} DT</b>
                <p style="font-size:12px">Ø§Ù„Ø¨Ø§Ø¦Ø¹: ${p.owner}</p>
                <button onclick="alert('Ø§ØªØµÙ„ Ø¨Ø§Ù„Ø¨Ø§Ø¦Ø¹ Ù„Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡')">Ø´Ø±Ø§Ø¡ Ø§Ù„Ø¢Ù†</button>
            </div>`;
    });
}

function loadProfile(){
    const p = document.getElementById("profile");
    p.innerHTML = `<h2>${currentUser.name} ${currentUser.lastname}</h2>
                   <p>Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†: ${currentUser.followers} ğŸ‘¤</p>
                   <hr><h3>Ù…Ù†ØªØ¬Ø§ØªÙŠ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©:</h3>`;
    currentUser.products.forEach(pdt => {
        p.innerHTML += `<div class="product"><h4>${pdt.name} - ${pdt.price} DT</h4></div>`;
    });
    p.innerHTML += `<button onclick="localStorage.removeItem('session'); location.reload();" style="background:red">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬</button>`;
}

function goHome(){ show("home"); loadHome(); }

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ù„Ø³Ø© Ø¯Ø®ÙˆÙ„ Ø³Ø§Ø¨Ù‚Ø©
window.onload = () => {
    let savedSession = localStorage.getItem("session");
    if(savedSession){
        currentUser = JSON.parse(savedSession);
        startApp();
    }
};
</script>
</body>
</html>
