<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Sport Market Games</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body {
    margin:0;
    font-family: 'Arial', sans-serif;
    background:#0b0f1a;
    color:#fff;
}

/* ===== Login ===== */
#login {
    height:100vh;
    display:flex;
    flex-direction:column;
    justify-content:center;
    align-items:center;
    padding:20px;
}
#login input, button {
    margin:8px 0;
    padding:12px;
    border-radius:8px;
    border:none;
    width:80%;
    max-width:300px;
}
button {
    background:#1e90ff;
    color:#fff;
    font-size:16px;
    cursor:pointer;
}

/* ===== App ===== */
#app { padding-bottom:70px; }
header {
    padding:15px;
    text-align:center;
    font-size:22px;
    font-weight:bold;
    background:#11162a;
    cursor:pointer;
}
.product {
    background:#161c36;
    margin:10px;
    padding:10px;
    border-radius:10px;
}
.product img {
    width:100%;
    border-radius:8px;
}
.nav {
    position:fixed;
    bottom:0;
    width:100%;
    background:#11162a;
    display:flex;
}
.nav div {
    flex:1;
    text-align:center;
    padding:10px;
    font-size:16px;
    cursor:pointer;
}
.star {
    color:#4fc3ff;
}

/* ===== Buttons ===== */
button.buy, button.follow {
    background:#4fc3ff;
    color:#000;
    padding:6px 12px;
    margin-top:6px;
    border-radius:6px;
    border:none;
    cursor:pointer;
}
.hidden { display:none; }
input { color:#000; }
</style>
</head>
<body>

<!-- LOGIN -->
<div id="login">
    <h2>ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    <input id="name" placeholder="Ø§Ù„Ø§Ø³Ù…">
    <input id="lastname" placeholder="Ø§Ù„Ù„Ù‚Ø¨">
    <input id="password" type="password" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±">
    <button onclick="login()">Ø¯Ø®ÙˆÙ„</button>
</div>

<!-- APP -->
<div id="app" class="hidden">
    <header onclick="goHome()">ğŸ® Sport Market</header>

    <!-- HOME -->
    <div id="home"></div>

    <!-- ADD PRODUCT -->
    <div id="add" class="hidden">
        <input id="pname" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="pprice" placeholder="Ø§Ù„Ø³Ø¹Ø±">
        <input id="plocation" placeholder="Ø§Ù„Ù…ÙƒØ§Ù†">
        <input id="pdesc" placeholder="ÙˆØµÙ Ø§Ù„Ù…Ù†ØªØ¬">
        <input id="pimg" placeholder="Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬">
        <button onclick="addProduct()">OK</button>
    </div>

    <!-- SEARCH -->
    <div id="search" class="hidden">
        <input id="searchInput" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø­Ø³Ø§Ø¨" oninput="searchUser()">
        <div id="searchResults"></div>
    </div>

    <!-- PROFILE -->
    <div id="profile" class="hidden"></div>
</div>

<!-- NAV -->
<div class="nav hidden" id="nav">
    <div onclick="show('home')">ğŸ </div>
    <div onclick="show('add')">â•</div>
    <div onclick="show('search')">ğŸ”</div>
    <div onclick="show('profile')">ğŸ‘¤</div>
</div>

<script>
let currentUser = null;

// ===== Login =====
function login(){
    const nameV = document.getElementById("name").value;
    const lastnameV = document.getElementById("lastname").value;
    const passwordV = document.getElementById("password").value;

    if(!nameV || !lastnameV || !passwordV){
        alert("Ø§Ù…Ù„Ø£ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„");
        return;
    }

    let users = JSON.parse(localStorage.getItem("users")||"[]");
    let user = users.find(u=> u.name==nameV && u.lastname==lastnameV);

    if(!user){
        user = {
            name: nameV,
            lastname: lastnameV,
            password: passwordV,
            followers: 0,
            products: []
        };
        users.push(user);
        localStorage.setItem("users", JSON.stringify(users));
    } else if(user.password !== passwordV){
        alert("ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø± Ø®Ø§Ø·Ø¦Ø©");
        return;
    }

    currentUser = user;
    loginDiv(false);
}

// ===== Show / Hide Sections =====
function loginDiv(ok){
    document.getElementById("login").classList.toggle("hidden", ok);
    document.getElementById("app").classList.toggle("hidden", !ok);
    document.getElementById("nav").classList.toggle("hidden", !ok);
    loadHome();
    loadProfile();
}

function show(id){
    ["home","add","search","profile"].forEach(x=> document.getElementById(x).classList.add("hidden"));
    document.getElementById(id).classList.remove("hidden");
}

// ===== Add Product =====
function addProduct(){
    const pnameV = document.getElementById("pname").value;
    const ppriceV = document.getElementById("pprice").value;
    const plocationV = document.getElementById("plocation").value;
    const pdescV = document.getElementById("pdesc").value;
    const pimgV = document.getElementById("pimg").value;

    if(!pnameV||!ppriceV||!plocationV||!pdescV||!pimgV){ alert("Ø§Ù…Ù„Ø£ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„"); return; }

    let products = JSON.parse(localStorage.getItem("products")||"[]");
    const product = {
        name: pnameV,
        price: ppriceV,
        location: plocationV,
        desc: pdescV,
        img: pimgV,
        owner: currentUser.name + " " + currentUser.lastname
    };
    products.push(product);
    localStorage.setItem("products", JSON.stringify(products));

    // Save product to user's products
    let users = JSON.parse(localStorage.getItem("users"));
    let index = users.findIndex(u => u.name==currentUser.name && u.lastname==currentUser.lastname);
    users[index].products.push(product);
    localStorage.setItem("users", JSON.stringify(users));
    currentUser = users[index];

    show("home");
    loadHome();
    loadProfile();
}

// ===== Load Home =====
function loadHome(){
    const home = document.getElementById("home");
    home.innerHTML = "";
    let products = JSON.parse(localStorage.getItem("products")||"[]");
    if(products.length==0) { home.innerHTML = "<p style='text-align:center;'>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</p>"; return; }
    products.forEach((p,i)=>{
        let div = document.createElement("div");
        div.className = "product";
        div.innerHTML = `
            <img src="${p.img}">
            <h3>${p.name}</h3>
            <p>${p.desc}</p>
            <b>${p.price} DT</b>
            <p>Ø§Ù„Ø¨Ø§Ø¦Ø¹: ${p.owner}</p>
            <button class="buy" onclick="buyProduct(${i})">Ø´Ø±Ø§Ø¡</button>
        `;
        home.appendChild(div);
    });
}

// ===== Search Users =====
function searchUser(){
    const val = document.getElementById("searchInput").value.toLowerCase();
    const res = document.getElementById("searchResults");
    res.innerHTML = "";
    if(!val) return;

    let users = JSON.parse(localStorage.getItem("users")||"[]");
    users.forEach(u=>{
        if(u.name.toLowerCase().includes(val) || u.lastname.toLowerCase().includes(val)){
            let star = u.followers>=1000?"â­":"";
            let div = document.createElement("div");
            div.className = "product";
            div.innerHTML = `<h3>${u.name} ${u.lastname} <span class="star">${star}</span></h3>
                             <p>Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†: ${u.followers}</p>
                             <button class="follow" onclick="followUser('${u.name}','${u.lastname}')">Ù…ØªØ§Ø¨Ø¹Ø©</button>`;
            res.appendChild(div);
        }
    });
}

// ===== Follow Users =====
function followUser(name, lastname){
    let users = JSON.parse(localStorage.getItem("users")||"[]");
    let user = users.find(u=> u.name==name && u.lastname==lastname);
    user.followers +=1;
    localStorage.setItem("users", JSON.stringify(users));
    if(currentUser.name==name && currentUser.lastname==lastname) currentUser = user;
    loadProfile();
    searchUser();
}

// ===== Load Profile =====
function loadProfile(){
    const p = document.getElementById("profile");
    let star = currentUser.followers >= 1000?"â­":"";
    let html = `<h2>${currentUser.name} ${currentUser.lastname} <span class="star">${star}</span></h2>
                <p>Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ†: ${currentUser.followers}</p>
                <h3>Ù…Ù†ØªØ¬Ø§ØªÙŠ:</h3>`;
    if(currentUser.products.length==0) html+="<p>Ù„Ù… ØªØ¶Ù Ø£ÙŠ Ù…Ù†ØªØ¬Ø§Øª Ø¨Ø¹Ø¯</p>";
    else currentUser.products.forEach(pdt=>{
        html+=`<div class="product">
                <img src="${pdt.img}">
                <h4>${pdt.name}</h4>
                <p>${pdt.desc}</p>
                <b>${pdt.price} DT</b>
               </div>`;
    });
    p.innerHTML = html;
}

// ===== Buy Product =====
function buyProduct(index){
    let products = JSON.parse(localStorage.getItem("products")||"[]");
    let product = products[index];

    let name = prompt("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ");
    let lastname = prompt("Ø§Ø¯Ø®Ù„ Ù„Ù‚Ø¨Ùƒ");
    let email = prompt("Ø§Ø¯Ø®Ù„ Ø­Ø³Ø§Ø¨ Gmail");
    let pass = prompt("Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ø³Ø±");

    let users = JSON.parse(localStorage.getItem("users")||"[]");
    let buyer = users.find(u=> u.name==name && u.lastname==lastname && u.password==pass);

    if(!buyer){ alert("Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± ØµØ­ÙŠØ­"); return; }

    let card = prompt(`Ø§Ø¯Ø®Ù„ Ø±Ù‚Ù… Ø¨Ø·Ø§Ù‚ØªÙƒ Ø§Ù„Ø¨Ù†ÙƒÙŠØ© Ù„Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„Ø¯ÙØ¹: Ø§Ù„Ù…Ø¨Ù„Øº ${product.price} DT`);
    alert(`ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! Ø®ØµÙ… 4% Ù„ØµØ§Ù„Ø­ Ø§Ù„Ù…ÙˆÙ‚Ø¹. Ø§Ù„Ù…Ø¯ÙÙˆØ¹: ${product.price} DT`);

    // Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ø¹Ø¯ Ø§Ù„Ø´Ø±Ø§Ø¡
    products.splice(index,1);
    localStorage.setItem("products", JSON.stringify(products));

    // ØªØ­Ø¯ÙŠØ« ØµÙØ­Ø§Øª
    loadHome();
    loadProfile();
}

function goHome(){ show("home"); loadHome(); }

// ===== Load Existing User =====
currentUser = JSON.parse(localStorage.getItem("currentUser"));
if(currentUser) loginDiv(false);
</script>
</body>
</html>
